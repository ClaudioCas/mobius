----------------------------------------------------------------------
22 Synchronization, Sync=Out
----------------------------------------------------------------------

22.1 Sync=Out, Record, Reset
     Record a loop, at end send StartSong and begin sending clocks.
     On Reset, send StopSong and stop sending clocks.
     Test: sync1

22.2 Sync=Out, Record, Multiply/Overdub, StartSong
     Spec says StartSong send when "finishing with Record" but this
     should be done for any Record ending?
     OK

22.3 Sync=Out, Multiply|Insert
     Increase pulse count to match new loop length.
     Suppress drift realign during any recording or loop extension mode.
     Test: sync2

22.4 Sync=Out, Remultiply
     Adjust pulse count up or down to match the new loop length.
     Adjust dealign to reflect the new beginning if content trimmed
     from the front.
     Test: sync3

22.x Sync=Out, Unrounded Insert


22.x Sync=Out, UnroundedSyncAdjust=Tempo, Unrounded Multiply, Trim
     Change tempo, send StartSong, reset pulse count to 8ths per cycle.
     BUG: almost works, but we're dealigning slightly.
     BUG: If we wrap the tempo because it was too small or too large, 
     shouldn't the pulse count be adjusted too?





22.x Sync=Out, AutoRealign
     While playing, retrigger the loop to align with the MIDI clocks
     being generated by the millisecond timer.  
     OK

22.x Sync=Out, Overdub, AutoRealign
     While recording, suppress drift retrigger.
     OK

22.x Sync=Out, Feedback, AutoRealign
     While applying feedback, suppress drift retrigger.









22.5 Sync=Out, UnroundedSyncMode=Tempo, Unrounded Multiply, TrimStart, TrimEnd
     Change tempo, send StartSong, reset pulse count to 8ths per cycle.
     BUG: almost works, but we're dealigning slightly.
     BUG: If we wrap the tempo because it was too small or too large, 
     shouldn't the pulse count be adjusted too?

22.6 Sync=Out, UnroundedSyncMode=Tempo, Unrounded Insert
     Change tempo, keep pulse count.
     bug: tempo changes, but initial pulse isn't correct, causes
     a retrigger with a large drift

22.7 Sync=Out, UnroundedSyncMode=Resize, Unrounded Insert
     Keep tempo, change pulse count.
     OK?  Round off errors recalculating the pluse count are usually high
     enough to disable sync.  
     bug: after disabling sync, undo restored sync but align was wrong
     and couldn't realign.

22.8 Sync=Out, UnroundedSyncMode=Keep, Unrounded Insert
     Keep tempo and pulse count.  Results in early drift retrigger.
     OK

22.9 Sync=Out, MuteMode=Start, Unmute
     Send StartSong
     OK
     bug: initial frame and/or pulse counter seems to be off resulting
     in an immediate drift retrigger.  Not bad, but should be able to avoid.

22.10 Sync=Out, MuteMode=Continuous, Mute/Undo
      Undo forces the unmute to be handled like MuteMode=Start, so we
      send StartSong.
      OK

22.11 Sync=Out, SamplerStyle=Start, Switch
      Send StartSong, adjust pulse count, and change tempo.
      OK

22.12 Sync=Out, SamplerStyle=Once, Switch
      Send StartSong, adjust pulse count, and change tempo.
      This isn't in the manual but since it triggers from the beginning
      it makes sense?
      bug: Doesn't seem to set the pulse counter right on the return
      transition, causes a drift retrigger.

22.13 Sync=Out, SamplerStyle=Attack, Switch
      Send StartSong, adjust pulse count, and change tempo.
      This isn't in the manual but since it triggers from the beginning
      it makes sense?
      OK

22.14 Sync=Out, SamplerStyle=Run, Switch
      Dealign.  Adjust pulse count and change tempo?  
      Q: EDP won't send SongPosition, but may be an interesting option.
      BUG: Not dealigning properly

22.15 Sync=Out, SamplerStyle=Continuous, Switch
      Dealign.  Adjust pulse count and change tempo.
      Q: EDP won't send SongPosition, but may be an interesting option.
      BUG: Not dealigning properly and/or could be sending SongPosition.

22.16 Sync=Out, SamplePlay
      Send StartSong? Not in the manual.
      Similar to SamplerStyle=Once, adjust pulse count and change tempo.
      Then restore when sample play ends?
      BUG: SamplePlay seems to be all wrong.
      
22.17 Sync=Out, Trigger or ReTrigger
      Send StartSong, adjust pulse count.
      Q: Not in manual, but should behave like SamplerStyle=Start?
      OK

22.18 Sync=Out, StartPoint
      Send StartSong.
      OK

22.19 Sync=Out, Undo, Redo
      Similar to a loop switch, adjust pulse count, change tempo, set dealign.
      BUG: tempo adjusting, but we no longer get realign messages so the
      pulse count may be getting lost.

22.20 Sync=Out, Record/Undo
      Manual says this sends StartSong but "only at the next loop start point".
      Q: Doesn't make sense, if you undo the initial record there is
      no loop start point?
      bug: Once you establish a loop, if you record again then undo, 
      sync is not restored.  EDP doesn't allow this.

22.21 Sync=Out, ReAlign or Mute/Multiply
      Wait for loop start point and send StartSong.
      Q: Spec says StartSong is sent during Sync=OutUserStart but
      contradicts for Sync=Out.  Assume the same.
      Q: Like having the option for this to behave like Sync=In, waiting
      for the external start point and retriggering.
      OK

22.22 Sync=Any, ReAlign, Multiply
      A Multiply during ReAlign mode cancels the realign.
      This is odd, but I guess consistent with using Mute/Multiply to
      enter ReAlign.  Support the more obvious Undo too.
      OK

22.23 Sync=Out, MuteReAlign
      Mute, wait for loop start point and send StartSong.
      OK

22.25 Sync=Out, MuteMode=Pause, Mute
      Since this is a new one, could stop/continue the device.  Yes!
      Could also be sending song position when dealigning in other cases.
      BUG: Sends StopSong, but doesn't send SongPosition on resume, seems
      to start the loop from the beginning but doesn't reset the pulse count.

22.26 Sync=Out, SpeedSyncAdjust=Tempo, Speed
      Keep pulse count, halve/double the tempo.
      OK

22.26.1 Sync=Out, SpeedSyncAdjust=Resize, Speed
        Keep tempo, halve/double the pulse count.
	BUG: not changing pulse count, premature retrigger

22.26.2 Sync=Out, SpeedSyncAdjust=Keep, Speed
        Keep tempo and pulse count, drift realign in the middle.
	OK

22.27 Sync=Out, Reverse
      Dealign.
      OK?  Sounds ok, dealign value looks right.

22.28 Sync=Out, StartSong (EDP calls it QuantMIDIStartSong)
     Send a MIDI StartSong message at the next loop start point.
     Operates in all the Sync modes.
     OK
     bug: If the drum machine is currently playing in sync, we can
     get a flam at the start point as the StartSong often causes the drum
     machine to play the first beat twice.  Not sure how to avoid that
     though we could send a StopSong a few millis before sending the StartSong.
     Or, try to detect if we're already at the external start point like
     we do with Retrigger?

22.29 Sync=Out, MuteStartSong (EDP calls it MuteQuantMIDIStartSong)
      Mute the current loop and send a MIDI StartSong message at the
      next loop start point. Operates in all the Sync modes.
      Q: Functionally the same as MuteRealign when Sync=Out?
      Q: Is the mute quantized or immediate?  Assuming immediate.
      Q: Is this a mode or an undoable event?  Assuming event.
      Q: If the event is undone, should we unmute?  Leaving in mute.
      Q: Should this send a StopSong first?  Seems useful to get both the
      loop and drum machine back in sync.  If the song is already started
      can be a flam when StartSong is sent.
      OK

22.30 Sync=Out, QuantMidiStartPoint (Long StartPoint)
      Set the start point to match the global MIDI start point.
      Clear dealignment.
      Q: This is not relevant for Sync=Out?  Maybe if we're out of alignment?
      A: Since we're not sending StartSong, I think this should be relevant
      for Sync=Out.
      OK

22.31 Sync=Out, StopSong
      Extended function, send a quantized MIDI StopSong message.
      Q: More useful to always do this on a cycle boundary rather
      than track the Quantize parameter?
      OK

22.32 Sync=Out, Overdub, AutoRealign
      EDP disables auto-realign when in a recording mode.  Currently
      we perform the realign which may result in loss of a recorded
      section, or the insertion of silence.
      This applies to all sync modes!
      OK

22.33 Sync=Out, AutoStartPoint
      Align start point with the global MIDI start point if feedback is low.
      Inverse of 22.32
      This applies to all sync modes!
      NI      

22.34 Sync=Out, MIDI Sync Indicators
      MIDI note messages sent at various sync points.
      Send on: loop start point, MIDI start point, cycle start, subcycle start
      MIDI start point sent only if different from loop start point
      Require either implementation of Source# or individual global bindings.
      This applies to all sync modes!
      NI

22.34 Sync=Out, No drift retrigger at record end
      bug: Getting an immediate drift retrigger after recording the
      initial loop.  It takes 1247 frames to get the first MIDI clock which
      is when the external device will start.  Since we know there will
      be an unpredictable trigger, should not even bother playing until
      the clock comes in, enter mute instead to make it less bumpy.
      101 111071: E: Record End(Record) 111104
      101 111104: Sync start tempo 95
      101 0: Set mode play
      101 0: Fading last layer
      0 0: 26 milliseconds to get to first clock, frame 1247
      101 1247: Sync start milli 25238 currrent 25242 interrupt 4293
      101 1247: Retrigger track 0 external start point at 
                MIDI clock 96 frame 1247 drift 1536
      101 1247: Sync retrigger from 1247 to 110815 dealign 0

22.35 Sync=Out, Load Project
      After loading a project, the firat track that is unmuted should
      become the sync master. 
      BUG: waiting for a track to record from scratch before assigning
      the sync master.

